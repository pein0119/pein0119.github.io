<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content="Make the world a better place!"/><title> Redis-1.0代码阅读（一） --开篇 | pein0119</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden"> Redis-1.0代码阅读（一） --开篇</h1><a id="logo" href="/">pein0119</a><p class="description">pein0119's blog</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title"> Redis-1.0代码阅读（一） --开篇</h1><div class="post-meta">2014-08-18 | <span class="categories">分类于<a href="/categories/redis/">redis</a></span></div><div class="post-content"><h2 id="为什么要阅读源代码？">为什么要阅读源代码？</h2><p>起因是看了“伯乐在线”上的两篇博客，<a href="http://blog.jobbole.com/50837/" target="_blank" rel="external">《向优秀代码学习：Redis源码概览》</a>和<a href="http://blog.jobbole.com/471/" target="_blank" rel="external">《阅读优秀代码是提高开发人员修为的一种捷径》。</a> 我只对c语言比较熟悉，虽然已经读过了很多c语言名著，比如说《c和指针》、《c专家编程》，c语言的语法已经基本了解，但是自己仍然写不出漂亮的代码，这一点在做“编译原理”课程设计的时候表现的尤为突出。老师要求我们实现一个编译器，我第一次用c语言写大型的程序，结果我对源文件的管理和变量的定义一塌糊涂，最后实在是写不下去了，只能草草了事。<br><a id="more"></a><br>所以，我想通过阅读比较优秀的源代码，学习源程序文件的组织和管理以及变量名的定义。选择Redis是因为它是一个主要用ANSI c开发的开源项目，可以获得它的源代码。1.0版本是Redis的第一个稳定版本，鉴于自己水平有限，所以先从这个版本开始阅读。  </p>
<p>Redis-1.0<a href="http://code.google.com/p/redis/downloads/list?can=1" target="_blank" rel="external">下载地址</a></p>
<h2 id="Redis介绍">Redis介绍</h2><p>该部分翻译自Redis-1.0源代码中的doc。 </p>
<h3 id="介绍">介绍</h3><p>Redis是一个数据库。更准确的说，它是一个小型的数据库，实现了一个”key”与”value”相关联的字典。比如说，我可以把key “surname_1992”关联到value “Smith”上。有趣的事情是，关联到key上的value类型并不局限于简单的strings,还可以是lists和sets，为这些类型提供了一系列的运行于服务器端的原子操作。 Redis将整个数据集存储在内存中，但是数据集可以异步的持久化到硬盘上。每次服务器重启的时候，备份就会被重新加载。 Redis保存数据集的操作是可配置的，你可以配置它在经过给定的秒数或对数据集操作多少次之后来保存数据集。比如说，你可以让Redis在操作数据集1000次并且至少经过60秒之后保存数据集。你可以设置这个组合操作的次数。 因为数据写操作是异步的，如果系统崩溃，上几次的查询操作会丢失（不过，这在很多应用中都是可以接受的）。但是，如果你的应用连丢失几条记录都是不可接受的，Redis提供了另外的解决方案，它支持master-slave复制操作。 </p>
<h3 id="超越了key-value数据库">超越了key-value数据库</h3><p>在大多数的key-value数据库中，key和value都是简单的strings类型。Redis的key也是strings类型，但是value可以是Strings、Lists、Sets类型，对这些类型。Redis都提供了一些命令来实现复杂的原子操作，所以你可以认为Redis是一个数据结构服务器。 比如说，你可以用LPUSH和RPUSH操作添加元素到key为“mylist”的list中，复杂度为O(1)。而后，你还以用LRANGE得到元素的范围，或者用LTRIM命令减少元素数目。Sets也很灵活，你可以对Sets（无序的字符串集合）添加和删除元素，然后让服务器端对Sets进行交、并、补操作。 所有的这些特征，对Lists和Sets排序的支持，可以允许你将Redis作为你的可扩展的应用的数据库，而不需要使用关系数据库。 </p>
<h3 id="Redis与Memcached的不同之处有哪些?">Redis与Memcached的不同之处有哪些?</h3><p>主要有以下两点： Memcached不能持久化，它仅仅是把所有的东西都放在内存中，但不保存，因为它主要用来作为cache.Redis可以用来作为应用程序的主要数据库。 和Memcached一样，Redis使用key-value模型，key是strings类型，但是value可以是lists和sets类型。而且可以进行复杂的操作，比如说，交操作,设置/获取lists中的第n个元素。也可以使用lists作为消息队列。 </p>
<h3 id="Redis支持锁操作吗？">Redis支持锁操作吗？</h3><p>不支持，Redis提供了原子原语，这样，程序员就可以使用“无锁”算法来使用Redis.想象一下，你有十台电脑和一个Redis服务器。你要计算一个很大的文本文件的单词数目，该文本划分到10台电脑，每台电脑只处理一部分，使用INCR命令就可以在每次发现一个单词对计数器加一。 Redis还支持其他的原子原语，比如说lists的PUSH/POP操作，POP RANDOM KEY UPDATE操作等。 </p>
<h3 id="多数据库支持">多数据库支持</h3><p>另一个同步原语是支持多数据库。每一个新连接默认选择“DB 0”，但是使用“SELECT”命令可以选择不同的数据库。“MOVE”操作可以将一个item原子地 从一个数据库移到另一个。和“RANDOMKEY”命令一起使用可以当作”无锁”算法的基础。 </p>
<h3 id="Redis数据类型">Redis数据类型</h3><p>Redis支持将以下三种类型作为value的类型： Strings: 字节序列。Redis的Strings是二进制安全的，所以它可以不仅可以存储文本，图像、压缩数据和其他任何东西都可以存储。 Lists：字符串列表，支持的操作有在头部添加元素，在尾部添加元素，获取列表长度，得到元素的范围，将列表截取到指定的长度，将列表排序等等。 Sets：无序的字符串集合。支持向集合中添加、删除元素，还支持集合间的交、并、差等操作。 value的类型可以是Strings、Lists、Sets。key的类型是Strings的子集，但不包含换行符（‘\n’）和空格（‘ ’）。 注意：有时候Strings中可以包含数字值，但是必须能够被Redis解析。比如说INCR命令被用来自动增加存储在指定key中的数值。这种情况下，Redis能够处理的处理的整数必须要能存储在“long long”类型中，”long long”代表64位无符号整数。 </p>
<h3 id="实现细节">实现细节</h3><p>Stings类型是用自动分配内存的字符串来实现的。Lists使用缓存长度的双链表实现的。Sets使用哈希表来实现，并采用链地址法来解决冲突。  </p>
<p>(结束)</p>
</div><div class="tags"><a href="/tags/redis/">redis</a></div><div class="post-nav"><a href="/2014/08/18/Redis-10代码阅读（二）---源文件组织结构/" class="pre"><i class="icon-previous">Redis-1.0代码阅读（二） --源文件组织结构</i></a><a href="/2014/08/06/在相邻元素相差1的数组中查找某一特定元素第一次出现的位置(非遍历)/" class="next">在相邻元素相差1的数组中查找某一特定元素第一次出现的位置(非遍历)<i class="icon-next"></i></a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div id="search"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/bash/">bash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法与数据结构/">算法与数据结构</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/SQL注入/" style="font-size: 15px;">SQL注入</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/cookie/" style="font-size: 15px;">cookie</a> <a href="/tags/session/" style="font-size: 15px;">session</a> <a href="/tags/算法与数据结构/" style="font-size: 15px;">算法与数据结构</a> <a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/php-fpm/" style="font-size: 15px;">php-fpm</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/emoji/" style="font-size: 15px;">emoji</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/11/27/bash代码片段/">bash代码片段</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/06/记一次-nginx-499-排查经历/">记一次'nginx 499'排查经历</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/20/PHP删除字符串中的emoji表情/">PHP删除字符串中的emoji表情</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/20/PHP调试小技巧/">PHP调试小技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/27/分销项目总结/">其实我在胡说八道</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/10/js获取url参数的值/">js获取url参数的值</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/25/MySQL服务器启动错误-The-server-quit-without-updating-PID-file/">MySQL服务器启动错误 'The server quit without updating PID file'</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/18/MySQL删除所有数据库/">MySQL删除所有数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/10/PHP中标量类型-隐式转换/">PHP中标量类型'隐式转换'</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/03/浏览器禁用cookie后如何使用session/">浏览器禁用cookie后如何使用session</a></li></ul></div><div class="widget"><div class="widget-title">友情链接</div></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">pein0119.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div></body></html>