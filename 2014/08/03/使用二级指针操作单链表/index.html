<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content="Make the world a better place!"/><title>使用二级指针操作单链表 | pein0119</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用二级指针操作单链表</h1><a id="logo" href="/">pein0119</a><p class="description">pein0119's blog</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">使用二级指针操作单链表</h1><div class="post-meta">2014-08-03 | <span class="categories">分类于<a href="/categories/算法与数据结构/">算法与数据结构</a></span></div><div class="post-content"><p>最近正在重读《编程珠玑》，对于以前忽略的细节，现在也有了更深的了解。<br>这是13章课后习题中的第4题，向有序单链表中插入新结点。linus曾经谈到过使用二级指针删除结点的问题，具体请见“<a href="http://coolshell.cn/articles/8990.html" target="_blank" rel="external">酷壳网</a>”。<br><a id="more"></a><br>作者介绍了两种方法，并在链表中创建了哨兵结点，第一种是我们常用的一级指针，我将它改成了C语言版本（其实没改什么东西），如下:  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> t)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    node * p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(head-&gt;val == t)</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(head-&gt;val &gt; t)</span><br><span class="line">    &#123;</span><br><span class="line">        head = newNode(t ,head);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(p = head; p-&gt;next-&gt;val &lt; t; p = p-&gt;next)</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(p-&gt;next-&gt;val == t)</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">    p-&gt;next = newNode(t, p-&gt;next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是我们常用的方法，也是老师讲过的标准方法，需要对head结点单独进行讨论，这个方法不难理解。<br>下面我们主要讨论作者介绍的第二种方法，使用二级指针来插入新结点，代码如下： </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用二级指针操作 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> t)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    node **p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(p = &amp;head; (*p)-&gt;val &lt; t; p = &amp;((*p)-&gt;next))</span><br><span class="line">    ;</span><br><span class="line">    <span class="keyword">if</span> ((*p)-&gt;val == t)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    *p = newNode(t, *p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用二级指针就可以不用将头结点单独讨论，插入第一个结点时， <code>p = &amp;head，*p = newNode(t, *p)</code>，相当于第一中方法中的  <code>head = newNode(t ,head)</code>, 这样第二种方法就将第一种方法中的两种情况(头结点和非头结点)都包含了。<br>对于非头结点的情况，即当前结点有前驱结点(设为prev结点)，此时<code>*p</code> 的值等于<code>prev-&gt;next</code>，即  <code>*p = newNode(t, *p)</code> 相当于 <code>prev-&gt;next = newNode(t, prev-&gt;next)</code>。<br>为了加深理解，我用gdb追踪各指针。 初始化链表后，head和sentinel都指向哨兵结点。  </p>
<p><img src="https://github.com/pein0119/pein0119.github.io/blob/master/image/14-08-03-1.jpg?raw=true" alt=""> </p>
<p>当我们使用二级指针向链表中插入1时：<br>insert函数的for循环结束后：<br><img src="https://github.com/pein0119/pein0119.github.io/blob/master/image/14-08-03-2.jpg?raw=true" alt=""><br>此时p指针指向的是head指针，<em>p等于head。 执行完    </em>p = newNode(t, <em>p);    之后：<br><img src="https://github.com/pein0119/pein0119.github.io/blob/master/image/14-08-03-3.jpg?raw=true" alt=""><br>此时p指针仍然指向head指针，但是head指针的指向了新插入的结点。 向链表中插入2，执行完insert函数中的for循环：<br><img src="https://github.com/pein0119/pein0119.github.io/blob/master/image/14-08-03-4.jpg?raw=true" alt=""><br>将存储1的结点命名为prev，0x602038其实是prev-next的地址，即此时p存储的是prev-&gt;next的地址，</em>p指向的是哨兵结点。 执行     <em>p = newNode(t, </em>p);  相当于执行 prev-&gt;next = newNode(t, prev-&gt;next)。 执行完之后:<br><img src="https://github.com/pein0119/pein0119.github.io/blob/master/image/14-08-03-5.jpg?raw=true" alt=""><br>此时p仍然指向prev-&gt;next,但是prev的next保存的地址变成了新生成的结点的内存地址，这样就完成了新结点的插入。<br>下面附上完整代码，方便需要的人运行，调试<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> val;</span><br><span class="line"><span class="keyword">struct</span> node *next;</span><br><span class="line">&#125;node;</span><br><span class="line"></span><br><span class="line">node *head, *sentinel;</span><br><span class="line"></span><br><span class="line"><span class="function">node* <span class="title">newNode</span><span class="params">(<span class="keyword">int</span> val, node *n)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">node *temp = (node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(node));</span><br><span class="line">temp-&gt;val = val;</span><br><span class="line">temp-&gt;next = n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initList</span><span class="params">(<span class="keyword">int</span> maxval)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">sentinel = head = newNode(maxval, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 使用二级指针操作 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> t)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">node **p;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(p = &amp;head; (*p)-&gt;val &lt; t; p = &amp;((*p)-&gt;next))</span><br><span class="line">;</span><br><span class="line"><span class="keyword">if</span> ((*p)-&gt;val == t)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">*p = newNode(t, *p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 一级指针 */</span></span><br><span class="line"><span class="comment">/* void insert(int t) */</span></span><br><span class="line"><span class="comment">/* &#123; */</span></span><br><span class="line"><span class="comment">/* 	node * p; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 	if(head-&gt;val == t) */</span></span><br><span class="line"><span class="comment">/* 		return ; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 	if(head-&gt;val &gt; t) */</span></span><br><span class="line"><span class="comment">/* 	&#123; */</span></span><br><span class="line"><span class="comment">/* 		head = newNode(t ,head); */</span></span><br><span class="line"><span class="comment">/* 		return ; */</span></span><br><span class="line"><span class="comment">/* 	&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 	for(p = head; p-&gt;next-&gt;val &lt; t; p = p-&gt;next) */</span></span><br><span class="line"><span class="comment">/* 		; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 	if(p-&gt;next-&gt;val == t) */</span></span><br><span class="line"><span class="comment">/* 		return ; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 	p-&gt;next = newNode(t, p-&gt;next); */</span></span><br><span class="line"><span class="comment">/* &#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">initList(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i)</span><br><span class="line">insert(a[i]);</span><br><span class="line"></span><br><span class="line">node *iterator;</span><br><span class="line"><span class="keyword">for</span>(iterator = head; iterator != sentinel; iterator = iterator-&gt;next)</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">"%d\n"</span>, iterator-&gt;val);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>(结束)</p>
</div><div class="tags"><a href="/tags/算法与数据结构/">算法与数据结构</a></div><div class="post-nav"><a href="/2014/08/03/python端口扫描/" class="pre"><i class="icon-previous">python端口扫描</i></a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div id="search"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/bash/">bash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法与数据结构/">算法与数据结构</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/SQL注入/" style="font-size: 15px;">SQL注入</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/cookie/" style="font-size: 15px;">cookie</a> <a href="/tags/session/" style="font-size: 15px;">session</a> <a href="/tags/算法与数据结构/" style="font-size: 15px;">算法与数据结构</a> <a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/twemproxy/" style="font-size: 15px;">twemproxy</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/php-fpm/" style="font-size: 15px;">php-fpm</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/emoji/" style="font-size: 15px;">emoji</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/23/记一次twemproxy错误排查/">记一次redis错误排查</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/27/bash代码片段/">bash代码片段</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/06/记一次-nginx-499-排查经历/">记一次'nginx 499'排查经历</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/20/PHP删除字符串中的emoji表情/">PHP删除字符串中的emoji表情</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/20/PHP调试小技巧/">PHP调试小技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/27/分销项目总结/">其实我在胡说八道</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/10/js获取url参数的值/">js获取url参数的值</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/25/MySQL服务器启动错误-The-server-quit-without-updating-PID-file/">MySQL服务器启动错误 'The server quit without updating PID file'</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/18/MySQL删除所有数据库/">MySQL删除所有数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/10/PHP中标量类型-隐式转换/">PHP中标量类型'隐式转换'</a></li></ul></div><div class="widget"><div class="widget-title">友情链接</div></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">pein0119.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div></body></html>